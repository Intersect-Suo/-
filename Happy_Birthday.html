
<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- å…è®¸è‡ªåŠ¨æ’­æ”¾çš„å…ƒæ•°æ® -->
    <meta name="autoplay" content="true">
    <!-- ç½‘é¡µæ ‡é¢˜ï¼Œä¹Ÿæ˜¯é€ç»™æœ‹å‹çš„ç¬¬ä¸€å¥ç¥ç¦ -->
    <title>ç¥æˆ‘çš„æœ‹å‹20å²ç”Ÿæ—¥å¿«ä¹ï¼</title>
    
    <!-- è‡ªåŠ¨æ’­æ”¾è§£å†³æ–¹æ¡ˆ -->
    <script>
        // è§£å†³è‡ªåŠ¨æ’­æ”¾é—®é¢˜çš„å‡½æ•°
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        const unlockAudio = () => {
            const audioCtx = new AudioContext();
            // åˆ›å»ºä¸€ä¸ªç©ºç™½éŸ³é¢‘ç¼“å†²åŒº
            const buffer = audioCtx.createBuffer(1, 1, 22050);
            const source = audioCtx.createBufferSource();
            source.buffer = buffer;
            source.connect(audioCtx.destination);
            // æ’­æ”¾é™éŸ³éŸ³é¢‘ä»¥è§£é”
            if (source.start) {
                source.start(0);
            } else {
                source.noteOn(0);
            }
            
            // ç§»é™¤æ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨
            document.removeEventListener('touchstart', unlockAudio);
            document.removeEventListener('touchend', unlockAudio);
            document.removeEventListener('click', unlockAudio);
            document.removeEventListener('keydown', unlockAudio);
        };
        
        // æ·»åŠ å„ç§äº‹ä»¶æ¥è§£é”éŸ³é¢‘
        document.addEventListener('touchstart', unlockAudio, false);
        document.addEventListener('touchend', unlockAudio, false);
        document.addEventListener('click', unlockAudio, false);
        document.addEventListener('keydown', unlockAudio, false);
    </script>
    <style>
        /* --- å¼•å…¥ä¸€æ¬¾æ¼‚äº®çš„Googleåœ¨çº¿è‰ºæœ¯å­—ä½“ 'Pacifico' --- */
        @import url('https://fonts.googleapis.com/css2?family=Pacifico&display=swap');

        /* --- åŸºç¡€å’Œé¡µé¢æ ·å¼ --- */
        body,
        html {
            margin: 0;
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            /* é˜²æ­¢å‡ºç°æ»šåŠ¨æ¡ */
            font-family: 'Microsoft YaHei', 'Segoe UI', 'Helvetica Neue', sans-serif;
            /* è®¾ç½®ä¸€ä¸ªä¼˜é›…çš„é€šç”¨å­—ä½“ */
            background: linear-gradient(135deg, #fce38a, #f38181);
            /* æ¸©æš–çš„æ¸å˜èƒŒæ™¯è‰² */
            user-select: none;
            /* ç¦æ­¢ç”¨æˆ·é€‰ä¸­æ–‡æœ¬ï¼Œæå‡æ¸¸æˆä½“éªŒ */
        }

        /* --- æ¸¸æˆå®¹å™¨ï¼Œæ‰€æœ‰ä¸‹è½çš„è›‹ç³•éƒ½åœ¨è¿™ä¸ªå®¹å™¨é‡Œ --- */
        #game-container {
            position: absolute;
            width: 100%;
            height: 100%;
            z-index: 10;
            /* å±‚çº§è¾ƒä½ï¼Œåœ¨UIå…ƒç´ ä¹‹ä¸‹ */
        }

        /* --- è›‹ç³•å…ƒç´ æ ·å¼ --- */
        .cake {
            position: absolute;
            /* ç»å¯¹å®šä½ï¼Œæ–¹ä¾¿ç”¨JSæ§åˆ¶ä½ç½® */
            font-size: 60px;
            /* è›‹ç³•å¤§å° */
            cursor: pointer;
            /* é¼ æ ‡æ‚¬åœæ—¶æ˜¾ç¤ºä¸ºå°æ‰‹å›¾æ ‡ */
            transition: transform 0.1s ease-out;
            /* æ‚¬åœæ”¾å¤§æ•ˆæœçš„å¹³æ»‘è¿‡æ¸¡ */
            z-index: 20;
            /* ç¡®ä¿è›‹ç³•åœ¨æ¸¸æˆå®¹å™¨çš„æœ€ä¸Šå±‚ */
            text-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
            /* ç»™è›‹ç³•ä¸€ä¸ªè½»å¾®çš„é˜´å½±ï¼Œå¢åŠ ç«‹ä½“æ„Ÿ */
        }

        /* é¼ æ ‡æ‚¬åœåœ¨è›‹ç³•ä¸Šæ—¶çš„æ”¾å¤§æ•ˆæœ */
        .cake:hover {
            transform: scale(1.15);
        }

        /* --- æ¸¸æˆUIå…ƒç´ å®¹å™¨ --- */
        #ui-container {
            position: relative;
            z-index: 100;
            /* UIå±‚çº§æœ€é«˜ï¼Œç¡®ä¿åœ¨æ‰€æœ‰æ¸¸æˆå…ƒç´ ä¹‹ä¸Š */
            width: 100%;
            height: 100%;
            display: flex;
            /* ä½¿ç”¨Flexboxå¸ƒå±€ */
            flex-direction: column;
            /* å‚ç›´æ’åˆ—å­å…ƒç´  */
            justify-content: center;
            /* å‚ç›´å±…ä¸­ */
            align-items: center;
            /* æ°´å¹³å±…ä¸­ */
            pointer-events: none;
            /* å®¹å™¨æœ¬èº«ä¸å“åº”é¼ æ ‡äº‹ä»¶ï¼Œå¯ä»¥è®©äº‹ä»¶ç©¿é€åˆ°ä¸‹å±‚å…ƒç´  */
        }

        /* --- å¼€å§‹æŒ‰é’®æ ·å¼ --- */
        #start-btn {
            padding: 30px 60px;
            /* å†…è¾¹è·ï¼Œå¢å¤§æŒ‰é’®çš„å¯ç‚¹å‡»åŒºåŸŸ */
            font-size: 80px;
            /* å¢å¤§å­—ä½“ï¼Œä½¿å…¶æ›´é†’ç›® */
            font-weight: bold;
            color: #FFD700;
            /* é‡‘è‰²ï¼Œå¢åŠ å–œåº†æ„Ÿ */
            background-color: #ff6b6b;
            /* æŒ‰é’®èƒŒæ™¯è‰² */
            border: none;
            /* å»æ‰è¾¹æ¡† */
            border-radius: 60px;
            /* åœ†è§’ï¼Œä½¿å…¶çœ‹èµ·æ¥æ›´æŸ”å’Œ */
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.3);
            /* æ¼‚äº®çš„é˜´å½±æ•ˆæœ */
            transition: all 0.2s ease;
            /* æ‰€æœ‰å˜åŒ–çš„å¹³æ»‘è¿‡æ¸¡ */
            pointer-events: auto;
            /* è¦†ç›–çˆ¶å®¹å™¨çš„noneï¼Œä½¿æŒ‰é’®å¯ä»¥è¢«ç‚¹å‡» */
            margin-bottom: 40px;
            /* ä¸ä¸‹æ–¹çš„æç¤ºæ–‡å­—å¢åŠ é—´è· */
        }

        /* é¼ æ ‡æ‚¬åœåœ¨å¼€å§‹æŒ‰é’®ä¸Šæ—¶çš„æ•ˆæœ */
        #start-btn:hover {
            background-color: #ff4757;
            /* é¢œè‰²åŠ æ·± */
            transform: translateY(-3px);
            /* æŒ‰é’®è½»å¾®ä¸Šæµ® */
            box-shadow: 0 12px 25px rgba(0, 0, 0, 0.35);
            /* é˜´å½±åŠ é‡ï¼Œäº§ç”Ÿç«‹ä½“æ„Ÿ */
        }

        /* --- å¼€å§‹æç¤ºæ–‡å­—æ ·å¼ --- */
        #start-hint {
            margin-top: 0;
            /* ç§»é™¤é»˜è®¤çš„ä¸Šå¤–è¾¹è· */
            font-size: 55px;
            /* å¢å¤§å­—ä½“ */
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.4);
            /* æ–‡å­—é˜´å½± */
            letter-spacing: 1px;
            /* å­—ç¬¦é—´è· */
            color: #FF69B4;
            /* æµªæ¼«çš„ç²‰è‰² */
        }

        /* --- ç§¯åˆ†æ¿æ ·å¼ --- */
        #score-board {
            position: fixed;
            /* å›ºå®šåœ¨è§†å£å³ä¸Šè§’ */
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: rgba(255, 255, 255, 0.8);
            /* åŠé€æ˜èƒŒæ™¯ */
            border-radius: 10px;
            font-size: 28px;
            font-weight: bold;
            color: #d63031;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transition: opacity 0.5s;
            /* ç”¨äºå®ç°æ·¡å‡ºæ•ˆæœ */
            pointer-events: none;
            /* ä¸å“åº”é¼ æ ‡äº‹ä»¶ */
        }

        /* --- é‡Œç¨‹ç¢‘æ¶ˆæ¯æ˜¾ç¤ºæ ·å¼ --- */
        #message-display {
            position: fixed;
            /* å›ºå®šåœ¨å±å¹•ä¸­å¤® */
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            /* ç²¾ç¡®å±…ä¸­ */
            font-size: 6vw;
            /* å“åº”å¼å­—ä½“å¤§å°ï¼Œæ ¹æ®è§†å£å®½åº¦å˜åŒ– */
            font-weight: bold;
            text-align: center;
            text-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
            pointer-events: none;
            opacity: 0;
            /* é»˜è®¤é€æ˜ */
            transition: opacity 0.5s ease-in-out;
            /* æ·¡å…¥æ·¡å‡ºåŠ¨ç”» */
        }

        /* å½“æ¶ˆæ¯æ˜¾ç¤ºæ—¶ï¼Œæ·»åŠ æ­¤ç±»ä½¿å…¶ä¸é€æ˜ */
        #message-display.show {
            opacity: 1;
        }

        /* --- æœ€ç»ˆç”Ÿæ—¥ç¥ç¦è¯­æ ·å¼ --- */
        #final-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 200;
            /* æœ€é«˜å±‚çº§ï¼Œæ˜¾ç¤ºåœ¨æœ€å‰æ–¹ */
            display: none;
            /* é»˜è®¤ä¸æ˜¾ç¤º */
            opacity: 0;
            /* é»˜è®¤é€æ˜ */
            transition: opacity 1.5s ease-in;
            /* ç¼“æ…¢æ·¡å…¥æ•ˆæœ */

            font-family: 'Pacifico', cursive;
            /* ä½¿ç”¨å¼•å…¥çš„è‰ºæœ¯å­—ä½“ */
            font-size: 8vw;
            /* å“åº”å¼å¤§å­—ä½“ */
            font-weight: bold;
            text-align: center;
            text-shadow: 4px 4px 6px rgba(0, 0, 0, 0.4);
            line-height: 1.6;
            /* å¢åŠ è¡Œé«˜ï¼Œé˜²æ­¢å¤šè¡Œæ–‡å­—é‡å  */

            /* æ ¸å¿ƒï¼šåˆ›å»ºåŠ¨æ€å½©è‰²æ–‡å­—æ•ˆæœ */
            background: linear-gradient(45deg, #FFD700, #FF69B4, #00CED1, #9370DB);
            /* å®šä¹‰ä¸€ä¸ªé²œè‰³çš„æ¸å˜èƒŒæ™¯ */
            background-size: 400% 400%;
            /* æ‰©å¤§èƒŒæ™¯å°ºå¯¸ï¼Œä¸ºåŠ¨ç”»åšå‡†å¤‡ */
            -webkit-background-clip: text;
            /* å°†èƒŒæ™¯è£å‰ªä¸ºæ–‡å­—çš„å½¢çŠ¶ (å…¼å®¹WebKitæµè§ˆå™¨) */
            background-clip: text;
            /* æ ‡å‡†å†™æ³• */
            color: transparent;
            /* å°†æ–‡å­—æœ¬èº«é¢œè‰²è®¾ä¸ºé€æ˜ï¼Œä»è€Œé€å‡ºèƒŒæ™¯çš„æ¸å˜è‰² */
            animation: gradient-animation 10s ease infinite;
            /* åº”ç”¨èƒŒæ™¯ä½ç§»åŠ¨ç”» */
        }

        /* --- å½©è‰²æ–‡å­—çš„èƒŒæ™¯ä½ç§»åŠ¨ç”» --- */
        @keyframes gradient-animation {
            0% {
                background-position: 0% 50%;
            }

            50% {
                background-position: 100% 50%;
            }

            100% {
                background-position: 0% 50%;
            }
        }

        /* --- ç‚¹å‡»è›‹ç³•åçš„äº”å½©çº¸å±‘æ ·å¼ --- */
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            opacity: 1;
            /* åŠ¨ç”»ï¼šåç§°ã€æ—¶é•¿ã€ç¼“åŠ¨å‡½æ•°ã€ç»“æŸæ—¶çŠ¶æ€ */
            animation: confetti-fall 1s ease-out forwards;
        }

        /* --- äº”å½©çº¸å±‘çš„ä¸‹è½å’Œæ¶ˆå¤±åŠ¨ç”» --- */
        @keyframes confetti-fall {
            0% {
                transform: translateY(0) rotateZ(0);
                opacity: 1;
            }

            100% {
                transform: translateY(200px) rotateZ(360deg);
                opacity: 0;
            }
        }
    </style>
</head>

<body>

    <!-- æ¸¸æˆåŒºåŸŸï¼Œç”¨äºæ‰¿è½½æ‰€æœ‰ä¸‹è½çš„è›‹ç³• -->
    <div id="game-container"></div>

    <!-- æ·»åŠ éŸ³é¢‘å…ƒç´ ï¼Œä½¿ç”¨æœ¬åœ°MP3æ–‡ä»¶ -->
    <audio id="birthday-song" loop preload="auto">
        <source src="music.mp3" type="audio/mpeg">
    </audio>
    <!-- UIç•Œé¢å®¹å™¨ï¼Œæ‰¿è½½æ‰€æœ‰æŒ‰é’®ã€æ–‡å­—ç­‰ç•Œé¢å…ƒç´  -->
    <div id="ui-container">
        <button id="start-btn">ğŸ‚ è›‹ç³•æµæ˜Ÿé›¨ ğŸ‚</button>
        <p id="start-hint">ç‚¹ç‚¹è›‹ç³•å¾—ç¥ç¦ ğŸ¥°</p>

        <!-- å›ºå®šçš„UIå…ƒç´ ï¼Œä¸éšFlexboxå±…ä¸­è€Œæ”¹å˜ä½ç½® -->
        <div id="score-board">ç§¯åˆ†: 0</div>
        <div id="message-display"></div>
        <div id="final-message"></div>
    </div>

    <script>
        // --- DOMå…ƒç´ è·å– ---
        const gameContainer = document.getElementById('game-container');
        const startBtn = document.getElementById('start-btn');
        const startHint = document.getElementById('start-hint');
        const scoreBoard = document.getElementById('score-board');
        const messageDisplay = document.getElementById('message-display');
        const finalMessage = document.getElementById('final-message');
        const birthdaySong = document.getElementById('birthday-song');

        // ä»»ä½•ç”¨æˆ·äº¤äº’éƒ½å°è¯•æ’­æ”¾éŸ³é¢‘ï¼ˆå¦‚æœå½“å‰æ˜¯æš‚åœçŠ¶æ€ï¼‰
        document.addEventListener('click', function() {
            if (birthdaySong.paused) {
                birthdaySong.volume = 1.0; // ç¡®ä¿éŸ³é‡æ˜¯æœ€å¤§çš„
                birthdaySong.muted = false; // ç¡®ä¿æ²¡æœ‰é™éŸ³
                birthdaySong.play().catch(function(e) {
                    console.error("ç‚¹å‡»åæ’­æ”¾å¤±è´¥:", e);
                });
            }
        });

        // --- å…¨å±€å˜é‡å®šä¹‰ ---
        let score = 0; // å½“å‰ç§¯åˆ†
        let gameInterval = null; // å­˜æ”¾ç”Ÿæˆè›‹ç³•çš„å®šæ—¶å™¨
        let animationFrameId = null; // å­˜æ”¾æ¸¸æˆå¾ªç¯çš„åŠ¨ç”»å¸§ID
        let cakes = []; // å­˜å‚¨æ‰€æœ‰åœ¨å±å¹•ä¸Šçš„è›‹ç³•å…ƒç´ 
        let gameEnded = false; // æ¸¸æˆæ˜¯å¦ç»“æŸçš„æ ‡å¿—

        // å®šä¹‰ä¸€ç»„å–œåº†çš„é¢œè‰²ï¼Œç”¨äºç¥ç¦è¯­å’Œå½©å±‘
        const celebrationColors = [
            '#FF4500', '#FF1493', '#00CED1', '#FFD700',
            '#9370DB', '#32CD32', '#FF6347'
        ];

        // --- äº‹ä»¶ç›‘å¬ ---
        // ä½¿ç”¨æ›´å¼ºå¤§çš„æ–¹æ³•ç¡®ä¿éŸ³é¢‘æ’­æ”¾
        function tryPlayAudio() {
            console.log("å°è¯•æ’­æ”¾éŸ³é¢‘...");
            birthdaySong.volume = 1.0;
            birthdaySong.muted = false;
            
            // ä½¿ç”¨PromiseåŒ…è£…play()æ–¹æ³•ä»¥ä¾¿æ›´å¥½åœ°å¤„ç†
            const playPromise = birthdaySong.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    console.log("éŸ³é¢‘æ’­æ”¾æˆåŠŸ!");
                }).catch(error => {
                    console.log("è‡ªåŠ¨æ’­æ”¾å¤±è´¥:", error);
                    // è®¾ç½®ä¸€ä¸ªç‚¹å‡»äº‹ä»¶æ¥è§£é”éŸ³é¢‘
                    document.body.addEventListener('click', function bodyClickHandler() {
                        birthdaySong.play();
                        console.log("é€šè¿‡ç‚¹å‡»äº‹ä»¶æ’­æ”¾éŸ³é¢‘");
                        // ç§»é™¤ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨ï¼Œé¿å…å¤šæ¬¡è§¦å‘
                        document.body.removeEventListener('click', bodyClickHandler);
                    }, { once: true });
                });
            }
        }

        // å°è¯•å¤šç§æ–¹æ³•è§¦å‘è‡ªåŠ¨æ’­æ”¾
        window.addEventListener('load', tryPlayAudio);
        
        // æ·»åŠ DOMContentLoadedäº‹ä»¶ç›‘å¬ä¹Ÿå°è¯•æ’­æ”¾
        document.addEventListener('DOMContentLoaded', tryPlayAudio);
        
        // æ·»åŠ éŸ³é¢‘åŠ è½½å®Œæˆäº‹ä»¶ç›‘å¬
        birthdaySong.addEventListener('canplaythrough', tryPlayAudio);
        
        // ä¸ºå¼€å§‹æŒ‰é’®ç»‘å®šç‚¹å‡»äº‹ä»¶ï¼Œè°ƒç”¨startGameå‡½æ•°å’Œæ’­æ”¾éŸ³ä¹
        startBtn.addEventListener('click', startGame);

        // --- å‡½æ•°å®šä¹‰ ---

        /**
         * @description å¼€å§‹æˆ–é‡ç½®æ¸¸æˆ
         */
        function startGame() {
            // ç¡®ä¿ç”Ÿæ—¥æ­Œæ›²æ’­æ”¾
            birthdaySong.volume = 1.0; // ç¡®ä¿éŸ³é‡æœ€å¤§
            birthdaySong.muted = false; // ç¡®ä¿æ²¡æœ‰é™éŸ³
            
            // å¦‚æœå¤„äºæš‚åœçŠ¶æ€ï¼Œå°è¯•æ’­æ”¾
            if (birthdaySong.paused) {
                birthdaySong.play().catch(function(error) {
                    console.log('æ¸¸æˆå¼€å§‹æ—¶æ’­æ”¾éŸ³ä¹å¤±è´¥:', error);
                });
            }
            
            // åˆå§‹åŒ–æ¸¸æˆçŠ¶æ€
            score = 0;
            gameEnded = false;
            updateScoreDisplay();
            messageDisplay.innerHTML = '';
            messageDisplay.classList.remove('show');

            // éšè—å¼€å§‹ç•Œé¢çš„å…ƒç´ 
            startBtn.style.display = 'none';
            startHint.style.display = 'none';

            // æ˜¾ç¤ºæ¸¸æˆä¸­çš„UIå…ƒç´ 
            scoreBoard.style.opacity = 1;
            // ç¡®ä¿æœ€ç»ˆç¥ç¦è¯­æ˜¯éšè—çš„
            finalMessage.style.display = 'none';
            finalMessage.style.opacity = 0;

            // æ¸…ç†ä¸Šä¸€æ¬¡æ¸¸æˆçš„å®šæ—¶å™¨å’ŒåŠ¨ç”»å¸§ï¼Œé˜²æ­¢å åŠ 
            if (gameInterval) clearInterval(gameInterval);
            if (animationFrameId) cancelAnimationFrame(animationFrameId);

            // è®¾ç½®æ–°çš„å®šæ—¶å™¨ï¼Œæ¯800æ¯«ç§’åˆ›å»ºä¸€ä¸ªè›‹ç³•
            gameInterval = setInterval(createCake, 800);
            // å¯åŠ¨æ¸¸æˆä¸»å¾ªç¯
            gameLoop();
        }

        /**
         * @description åˆ›å»ºä¸€ä¸ªè›‹ç³•å¹¶æ·»åŠ åˆ°æ¸¸æˆä¸­
         */
        function createCake() {
            if (gameEnded) return; // å¦‚æœæ¸¸æˆå·²ç»“æŸï¼Œåˆ™ä¸å†åˆ›å»ºè›‹ç³•

            const cake = document.createElement('div');
            cake.textContent = 'ğŸ‚';
            cake.classList.add('cake');

            // éšæœºåŒ–è›‹ç³•çš„åˆå§‹æ°´å¹³ä½ç½®å’Œä¸‹è½é€Ÿåº¦
            cake.style.left = Math.random() * (window.innerWidth - 60) + 'px';
            cake.style.top = '-80px'; // ä»å±å¹•å¤–ä¸Šæ–¹å¼€å§‹
            cake.dataset.speed = Math.random() * 1.5 + 1; // å­˜å‚¨é€Ÿåº¦å€¼

            // ä¸ºæ¯ä¸ªè›‹ç³•å•ç‹¬ç»‘å®šç‚¹å‡»äº‹ä»¶
            cake.addEventListener('click', (event) => {
                event.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œå¯é€‰ï¼Œä½†æœ‰æ—¶æ˜¯å¥½ä¹ æƒ¯
                handleCakeClick(cake, event.clientX, event.clientY);
            });

            gameContainer.appendChild(cake);
            cakes.push(cake); // å°†æ–°è›‹ç³•å­˜å…¥æ•°ç»„ä»¥ä¾¿ç®¡ç†
        }

        /**
         * @description æ¸¸æˆä¸»å¾ªç¯ï¼Œè´Ÿè´£ç§»åŠ¨è›‹ç³•
         */
        function gameLoop() {
            // ä»åå¾€å‰éå†æ•°ç»„ï¼Œè¿™æ ·åœ¨åˆ é™¤å…ƒç´ æ—¶ä¸ä¼šå½±å“åç»­éå†
            for (let i = cakes.length - 1; i >= 0; i--) {
                const cake = cakes[i];
                let top = parseFloat(cake.style.top);
                top += parseFloat(cake.dataset.speed); // æ ¹æ®é€Ÿåº¦æ›´æ–°å‚ç›´ä½ç½®
                cake.style.top = top + 'px';

                // å¦‚æœè›‹ç³•ç§»å‡ºå±å¹•ä¸‹æ–¹ï¼Œåˆ™ä»DOMå’Œæ•°ç»„ä¸­ç§»é™¤
                if (top > window.innerHeight) {
                    cake.remove();
                    cakes.splice(i, 1);
                }
            }
            // è¯·æ±‚ä¸‹ä¸€å¸§åŠ¨ç”»ï¼Œå½¢æˆå¹³æ»‘çš„åŠ¨ç”»å¾ªç¯
            animationFrameId = requestAnimationFrame(gameLoop);
        }

        /**
         * @description å¤„ç†è›‹ç³•è¢«ç‚¹å‡»çš„é€»è¾‘
         * @param {HTMLElement} cakeElement - è¢«ç‚¹å‡»çš„è›‹ç³•å…ƒç´ 
         * @param {number} clickX - ç‚¹å‡»çš„æ¨ªåæ ‡
         * @param {number} clickY - ç‚¹å‡»çš„çºµåæ ‡
         */
        function handleCakeClick(cakeElement, clickX, clickY) {
            // é˜²æ­¢é‡å¤ç‚¹å‡»æˆ–åœ¨æ¸¸æˆç»“æŸåç‚¹å‡»
            if (!cakeElement.parentNode || gameEnded) return;

            score++; // åˆ†æ•°å¢åŠ 
            updateScoreDisplay(); // æ›´æ–°åˆ†æ•°æ˜¾ç¤º
            createConfettiEffect(clickX, clickY); // åˆ›å»ºå½©å±‘æ•ˆæœ

            // ä»DOMå’Œæ•°ç»„ä¸­ç§»é™¤è¢«ç‚¹å‡»çš„è›‹ç³•
            cakeElement.remove();
            const index = cakes.indexOf(cakeElement);
            if (index > -1) {
                cakes.splice(index, 1);
            }
            checkMilestones(); // æ£€æŸ¥æ˜¯å¦è¾¾åˆ°ç§¯åˆ†é‡Œç¨‹ç¢‘
        }

        /**
         * @description æ›´æ–°å³ä¸Šè§’çš„åˆ†æ•°æ˜¾ç¤º
         */
        function updateScoreDisplay() {
            scoreBoard.textContent = `ç§¯åˆ†: ${score}`;
        }

        /**
         * @description æ£€æŸ¥ç§¯åˆ†æ˜¯å¦è¾¾åˆ°é‡Œç¨‹ç¢‘ï¼Œå¹¶æ˜¾ç¤ºç›¸åº”ç¥ç¦
         */
        function checkMilestones() {
            if (gameEnded) return;

            let message = '';
            let showMessage = false;
            let messageColor = '';

            if (score === 5) {
                message = 'ç”Ÿæ—¥å¿«ä¹ï¼';
                showMessage = true;
                messageColor = celebrationColors[0];
            } else if (score === 10) {
                message = '20å²å•¦ï¼';
                showMessage = true;
                messageColor = celebrationColors[1];
            } else if (score === 15) {
                message = 'å¿«ä¹å¤©å¤© ğŸ˜';
                showMessage = true;
                messageColor = celebrationColors[2];
            } else if (score === 20) {
                message = 'æ¡ƒèŠ±æ»¡æ»¡ ğŸŒ¹';
                showMessage = true;
                messageColor = celebrationColors[3];
                gameEnded = true; // æ ‡è®°æ¸¸æˆç»“æŸ
                setTimeout(endGame, 3000); // 3ç§’åè§¦å‘æ¸¸æˆç»“æŸåŠ¨ç”»
            }

            // å¦‚æœéœ€è¦æ˜¾ç¤ºæ¶ˆæ¯ï¼Œåˆ™è®¾ç½®å†…å®¹ã€é¢œè‰²å¹¶æ·»åŠ  'show' ç±»ä½¿å…¶å¯è§
            if (showMessage) {
                messageDisplay.innerHTML = message;
                messageDisplay.style.color = messageColor;
                messageDisplay.classList.add('show');
                // 2.8ç§’åè‡ªåŠ¨éšè—æ¶ˆæ¯
                setTimeout(() => {
                    messageDisplay.classList.remove('show');
                }, 2800);
            }
        }

        /**
         * @description æ¸¸æˆç»“æŸæ—¶çš„æœ€ç»ˆåœºé¢
         */
        function endGame() {
            // åœæ­¢æ‰€æœ‰æ¸¸æˆæ´»åŠ¨
            clearInterval(gameInterval);
            cancelAnimationFrame(animationFrameId);

            // æ¸…ç©ºå±å¹•ä¸Šçš„æ‰€æœ‰è›‹ç³•
            gameContainer.innerHTML = '';
            cakes = [];

            // æ·¡å‡ºç§¯åˆ†æ¿
            scoreBoard.style.opacity = 0;

            // è®¾ç½®å¹¶æ˜¾ç¤ºæœ€ç»ˆçš„ç”Ÿæ—¥ç¥ç¦è¯­
            finalMessage.innerHTML = 'Happy Birthday,<br>æ½˜å˜‰è±ª!';
            finalMessage.style.display = 'block';

            // å»¶è¿Ÿä¸€ç‚¹ç‚¹å†æ”¹å˜é€æ˜åº¦ï¼Œä»¥ç¡®ä¿CSSè¿‡æ¸¡åŠ¨ç”»èƒ½è¢«è§¦å‘
            setTimeout(() => {
                finalMessage.style.opacity = 1;
            }, 100);
        }

        /**
         * @description åœ¨æŒ‡å®šä½ç½®åˆ›å»ºäº”å½©çº¸å±‘çˆ†ç‚¸æ•ˆæœ
         * @param {number} x - çˆ†ç‚¸ä¸­å¿ƒçš„æ¨ªåæ ‡
         * @param {number} y - çˆ†ç‚¸ä¸­å¿ƒçš„çºµåæ ‡
         */
        function createConfettiEffect(x, y) {
            const confettiCount = 30; // çº¸å±‘æ•°é‡
            for (let i = 0; i < confettiCount; i++) {
                const confetti = document.createElement('div');
                confetti.classList.add('confetti');
                confetti.style.left = x + 'px';
                confetti.style.top = y + 'px';
                // éšæœºé€‰æ‹©ä¸€ä¸ªå–œåº†çš„é¢œè‰²
                confetti.style.backgroundColor = celebrationColors[Math.floor(Math.random() * celebrationColors.length)];

                // ç»™æ¯ä¸ªçº¸å±‘ä¸€ä¸ªéšæœºçš„è¿åŠ¨è½¨è¿¹å’Œæ—‹è½¬è§’åº¦
                const randomX = (Math.random() - 0.5) * 400;
                const randomY = (Math.random() - 0.5) * 400;
                const randomRotation = Math.random() * 360;

                confetti.style.transform = `translate(${randomX}px, ${randomY}px) rotateZ(${randomRotation}deg)`;
                gameContainer.appendChild(confetti);

                // 1ç§’åè‡ªåŠ¨ç§»é™¤çº¸å±‘ï¼Œé˜²æ­¢DOMå…ƒç´ è¿‡å¤š
                setTimeout(() => {
                    confetti.remove();
                }, 1000);
            }
        }
    </script>
</body>

</html>